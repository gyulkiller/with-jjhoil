<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TH3NAME - SoundCloud Auto Player</title>
  <link rel="stylesheet" href="../styles.css" />
  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
      background: #000;
      color: #fff;
      min-height: 100vh;
    }
    .container {
      width: 100%;
      max-width: 960px;
      margin: calc(var(--header-h, 56px) + 24px) auto 32px;
      padding: 0 20px;
    }
    h1 {
      font-size: 28px;
      margin: 0 0 8px;
    }
    p.desc { color: rgba(255,255,255,0.7); margin: 0 0 16px; }
    .controls { margin: 16px 0 20px; }
    button#startButton {
      background: #ffffff;
      color: #000;
      border: none;
      padding: 12px 16px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
    }
    button#startButton[hidden] { display: none; }
    .player-wrap {
      background: #111;
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      overflow: hidden;
    }
    iframe#sc-player {
      width: 100%;
      border: 0;
      display: block;
      background: transparent;
    }
    /* 데스크탑(클래식) / 모바일(비주얼) 높이 튜닝 */
    iframe#sc-player.classic { height: 300px; }
    iframe#sc-player.visual { height: 480px; }
    .hint { margin-top: 10px; color: rgba(255,255,255,0.55); font-size: 14px; }

    /* Animated warm orange gradient background */
    .gradient-bg {
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
      background:
        radial-gradient(60% 80% at 15% 20%, rgba(255, 140, 60, 0.50), transparent 60%),
        radial-gradient(70% 90% at 85% 25%, rgba(255, 190, 90, 0.45), transparent 60%),
        radial-gradient(70% 80% at 50% 85%, rgba(255, 90, 60, 0.40), transparent 60%),
        linear-gradient(180deg, #f3f3f3 0%, #ff8b8b 100%);
      background-blend-mode: screen, screen, screen, normal;
      background-size: 160% 160%, 160% 160%, 160% 160%, 100% 100%;
      background-position: 0% 0%, 100% 0%, 50% 100%, center;
      animation: gradientMove 3s ease-in-out infinite alternate;
      will-change: background-position;
    }

    @keyframes gradientMove {
      0%   { background-position: 0% 0%, 100% 0%, 50% 100%, center; }
      50%  { background-position: 40% 30%, 70% 40%, 40% 60%, center; }
      100% { background-position: 100% 100%, 0% 100%, 50% 0%, center; }
    }

    /* Album skin styles */
    .album-skin {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 16px 60px rgba(0,0,0,0.35);
      background: #121212;
      border: 1px solid rgba(255,255,255,0.12);
    }
    .album-cover {
      position: relative;
      width: 100%;
      aspect-ratio: 1 / 1;
      background: url('./img/visible_truth.png') center/cover no-repeat;
      filter: saturate(1.05) contrast(1.02);
    }
    .skin-overlay {
      position: absolute; inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,0) 55%, rgba(0,0,0,0.66) 100%);
      pointer-events: none;
    }
    .skin-controls {
      position: absolute; left: 0; right: 0; bottom: 0;
      padding: 18px 16px 16px;
      display: grid; gap: 12px;
      background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,0,0,0.55) 30%, rgba(0,0,0,0.75) 100%);
      color: #fff;
    }
    .skin-meta { display: grid; gap: 4px; }
    .skin-title { font-weight: 800; letter-spacing: -0.01em; font-size: 18px; }
    .skin-artist { opacity: 0.8; font-size: 13px; }
    .skin-buttons { display: inline-flex; gap: 10px; align-items: center; }
    .btn {
      display: inline-grid; place-items: center;
      width: 40px; height: 40px; border-radius: 999px;
      background: rgba(255,255,255,0.9); color: #111; border: none; cursor: pointer;
      transition: transform .15s ease, box-shadow .2s ease;
      box-shadow: 0 8px 24px rgba(0,0,0,0.35);
    }
    .btn:hover { transform: translateY(-1px); }
    .btn--prev, .btn--next { background: rgba(255,255,255,0.18); color: #fff; border: 1px solid rgba(255,255,255,0.18); }
    .btn--play { width: 52px; height: 52px; background: #ffd24d; }
    .progress { position: relative; height: 6px; background: rgba(255,255,255,0.18); border-radius: 999px; overflow: hidden; }
    .progress__bar { position: absolute; left: 0; top: 0; bottom: 0; width: 100%; transform-origin: left center; transform: scaleX(0); background: linear-gradient(90deg, #ffb84d, #ff7a59); }

    /* Track list */
    .tracks { margin-top: 14px; }
    .tracklist { background: rgba(0,0,0,0.45); border: 1px solid rgba(255,255,255,0.12); border-radius: 14px; overflow: hidden; }
    .track { width: 100%; display: grid; grid-template-columns: 32px 1fr auto; align-items: center; gap: 12px; padding: 12px 14px; background: transparent; color: #fff; border: none; cursor: pointer; text-align: left; }
    .track + .track { border-top: 1px solid rgba(255,255,255,0.06); }
    .track:hover { background: rgba(255,255,255,0.06); }
    .track.active { background: rgba(255, 122, 89, 0.22); }
    .track .order { font-variant-numeric: tabular-nums; opacity: 0.8; }
    .track .info { display: grid; gap: 2px; }
    .track .title { font-weight: 700; letter-spacing: -0.01em; }
    .track .meta { font-size: 12px; opacity: 0.7; }
    .track .dur { font-variant-numeric: tabular-nums; opacity: 0.85; }
  </style>
</head>
<body>
  <div class="gradient-bg" aria-hidden="true"></div>
  <header class="site-header" role="navigation" aria-label="Primary Navigation">
    <nav class="nav">
      <a class="brand" href="/"><img class="brand-logo" src="../svg/onlyu.svg" alt="그이름 로고" />&nbsp;함께 WITH</a>
      <ul class="nav-menu">
        <li><a href="/music">MUSIC</a></li>
        <li><a href="/yield">YIELD</a></li>
        <li><a href="http://instagram.com/thenames_kr">RECIPE</a></li>
        <li><a href="https://jjhoil.com">SHOP</a></li>
      </ul>
    </nav>
  </header>
  <main class="container">
    <div class="album-skin" role="region" aria-label="VISIBLE TRUTH player">
      <div class="album-cover" aria-hidden="true"></div>
      <div class="skin-overlay"></div>
      <div class="skin-controls">
        <div class="skin-meta">
          <div class="skin-title">VISIBLE TRUTH</div>
          <div class="skin-artist">TH3NAME</div>
        </div>
        <div class="skin-buttons">
          <button class="btn btn--prev" aria-label="이전 곡">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 12l12-8v16L6 12z" fill="#fff"/></svg>
          </button>
          <button class="btn btn--play" aria-label="재생">
            <svg class="icon-play" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8 5v14l11-7L8 5z" fill="#111"/></svg>
            <svg class="icon-pause" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:none"><path d="M7 5h4v14H7zM13 5h4v14h-4z" fill="#111"/></svg>
          </button>
          <button class="btn btn--next" aria-label="다음 곡">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 12L6 20V4l12 8z" fill="#fff"/></svg>
          </button>
        </div>
        <div class="progress" aria-label="재생 진행도" role="slider" tabindex="0">
          <div class="progress__bar"></div>
    </div>
    </div>
      <iframe id="sc-backend" title="SoundCloud backend" allow="autoplay" style="position:absolute; width:1px; height:1px; border:0; opacity:0; pointer-events:none;"></iframe>
    </div>
  </main>
  <section class="tracks" aria-label="곡 목록">
    <div id="tracklist" class="tracklist" role="list"></div>
  </section>

  <script src="https://w.soundcloud.com/player/api.js"></script>
  <script>
    const backend = document.getElementById('sc-backend');
    const playBtn = document.querySelector('.btn--play');
    const iconPlay = playBtn.querySelector('.icon-play');
    const iconPause = playBtn.querySelector('.icon-pause');
    const prevBtn = document.querySelector('.btn--prev');
    const nextBtn = document.querySelector('.btn--next');
    const progress = document.querySelector('.progress');
    const progressBar = document.querySelector('.progress__bar');
    const trackListEl = document.getElementById('tracklist');

    const playlistUrl = 'https://api.soundcloud.com/playlists/2063852271';
      const params = new URLSearchParams({
      url: playlistUrl,
        auto_play: 'false',
        hide_related: 'true',
      show_comments: 'false',
      show_user: 'false',
      show_reposts: 'false',
        show_teaser: 'false',
      visual: 'false'
    });
    // iOS 인앱/사파리에서 사용자 제스처 직후 즉시 초기화되도록 지연 로드하지 않음
    backend.src = 'https://w.soundcloud.com/player/?' + params.toString();

    let widget = null;
    let isPlaying = false;
    let isWidgetReady = false;
    let sounds = [];
    let idToIndex = new Map();

    function setPlayingUI(playing) {
      isPlaying = playing;
      iconPlay.style.display = playing ? 'none' : '';
      iconPause.style.display = playing ? '' : 'none';
      playBtn.setAttribute('aria-label', playing ? '일시정지' : '재생');
    }

    function seekByClientX(clientX) {
      widget.getDuration(function (dur) {
        const rect = progress.getBoundingClientRect();
        const ratio = Math.min(1, Math.max(0, (clientX - rect.left) / rect.width));
        widget.seekTo(ratio * dur);
      });
    }

    function formatDuration(ms) {
      const totalSec = Math.round((ms || 0) / 1000);
      const m = Math.floor(totalSec / 60);
      const s = totalSec % 60;
      return m + ':' + String(s).padStart(2, '0');
    }

    function renderTrackList(arr) {
      trackListEl.innerHTML = '';
      arr.forEach((s, i) => {
        const row = document.createElement('button');
        row.type = 'button';
        row.className = 'track';
        row.setAttribute('role', 'listitem');
        row.dataset.index = String(i);

        const order = document.createElement('span');
        order.className = 'order';
        order.textContent = String(i + 1).padStart(2, '0');

        const info = document.createElement('span');
        info.className = 'info';
        const title = document.createElement('span');
        title.className = 'title';
        title.textContent = s && s.title ? s.title : 'Untitled';
        const meta = document.createElement('span');
        meta.className = 'meta';
        meta.textContent = (s && s.user && s.user.username) ? s.user.username : 'TH3NAME';
        info.appendChild(title);
        info.appendChild(meta);

        const dur = document.createElement('span');
        dur.className = 'dur';
        dur.textContent = formatDuration(s && s.duration);

        row.appendChild(order);
        row.appendChild(info);
        row.appendChild(dur);

        row.addEventListener('click', () => { try { widget.skip(i); widget.play(); } catch (_) {} });
        trackListEl.appendChild(row);
      });
    }

    function setActiveIndex(index) {
      const rows = trackListEl.querySelectorAll('.track');
      rows.forEach((el) => el.classList.toggle('active', Number(el.dataset.index) === Number(index)));
    }

    window.addEventListener('load', function () {
      widget = SC.Widget(backend);
      widget.bind(SC.Widget.Events.READY, function () {
        isWidgetReady = true;
        widget.getSounds(function (arr) {
          sounds = Array.isArray(arr) ? arr : [];
          idToIndex = new Map(sounds.map((s, i) => [String(s.id), i]));
          renderTrackList(sounds);
        });

        // progress loop
        widget.bind(SC.Widget.Events.PLAY, function () { setPlayingUI(true); });
        widget.bind(SC.Widget.Events.PAUSE, function () { setPlayingUI(false); });
        widget.bind(SC.Widget.Events.FINISH, function () { try { widget.next(); } catch (_) {} });
        widget.bind(SC.Widget.Events.PLAY_PROGRESS, function (e) {
          const pct = Math.max(0, Math.min(1, e.relativePosition || 0));
          progressBar.style.transform = 'scaleX(' + pct + ')';
        });
        widget.bind(SC.Widget.Events.PLAY, function () {
          try {
            widget.getCurrentSound(function (cur) {
              const idx = cur && cur.id != null ? idToIndex.get(String(cur.id)) : null;
              if (idx != null) setActiveIndex(idx);
            });
          } catch(_) {}
        });
      });

      playBtn.addEventListener('click', function () {
        if (!widget) return;
        if (!isWidgetReady) {
          const onReadyAndPlay = function () {
            isWidgetReady = true;
            try { widget.play(); } catch(_) {}
          };
          try { widget.bind(SC.Widget.Events.READY, onReadyAndPlay); } catch(_) {}
          return;
        }
        if (isPlaying) { widget.pause(); } else { widget.play(); }
      });
      prevBtn.addEventListener('click', () => { try { widget.prev(); } catch (_) {} });
      nextBtn.addEventListener('click', () => { try { widget.next(); } catch (_) {} });

      progress.addEventListener('click', (ev) => seekByClientX(ev.clientX));
      progress.addEventListener('keydown', (ev) => {
        if (ev.key === 'ArrowLeft' || ev.key === 'ArrowRight') {
          ev.preventDefault();
          widget.getDuration((dur) => {
            widget.getPosition((pos) => {
              const delta = (ev.key === 'ArrowRight' ? 5 : -5) * 1000; // 5s step
              widget.seekTo(Math.max(0, Math.min(dur, pos + delta)));
            });
          });
        }
      });
    });
  </script>
</body>
</html>


